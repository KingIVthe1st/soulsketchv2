<!DOCTYPE html>
<html lang="zxx">
  <head>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <meta
      name="description"
      content="Start your sketch with our 7‑step frontend demo. Save progress locally and see a sample upon completion."
    />
    <meta name="keywords" content="" />
    <meta name="author" content="RW2DESIGN PRIVATE LIMITED" />
    <!-- Page Title -->
    <title>Start Your Sketch — Sketch My Soulmate (Demo)</title>
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.png" />
    <!-- Google Fonts Css-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300..800&family=Manrope:wght@200..800&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap Css -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen" />
    <!-- SlickNav Css -->
    <link href="css/slicknav.min.css" rel="stylesheet" />
    <!-- Swiper Css -->
    <link rel="stylesheet" href="css/swiper-bundle.min.css" />
    <!-- Font Awesome Icon Css-->
    <link href="css/all.min.css" rel="stylesheet" media="screen" />
    <!-- Animated Css -->
    <link href="css/animate.css" rel="stylesheet" />
    <!-- Magnific Popup Core Css File -->
    <link rel="stylesheet" href="css/magnific-popup.css" />
    <!-- Mouse Cursor Css File -->
    <link rel="stylesheet" href="css/mousecursor.css" />
    <!-- Main Custom Css -->
    <link href="css/custom.css" rel="stylesheet" media="screen" />
    <!-- Stripe JS -->
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body>
    <!-- Preloader Start -->
    <div class="preloader">
      <div class="loading-container">
        <div class="loading"></div>
        <div id="loading-icon"><img src="images/loader.svg" alt="" /></div>
      </div>
    </div>
    <!-- Preloader End -->

    <!-- Header Start -->
    <header class="main-header bg-section">
      <div class="header-sticky">
        <nav class="navbar navbar-expand-lg">
          <div class="container-fluid">
            <!-- Logo Start -->
            <a class="navbar-brand" href="index.html">
              <img
                src="images/logo.svg"
                alt="Sketch My Soulmate Logo"
                style="width: 100px; height: 50px"
              />
            </a>
            <!-- Logo End -->

            <div>
              <a href="order.html" class="btn-default">Home</a>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- Header End -->

    <!-- Order Wizard Start -->
    <div class="contact-map-form" style="padding: 40px 0px">
      <div class="container">
        <div class="row section-row">
          <div class="col-lg-10 offset-lg-1">
            <div class="order-progress wow fadeInUp" data-wow-delay="0.1s">
              <div id="stepLabel">Step 1 of 5 — About you</div>
              <div
                class="progress"
                role="progressbar"
                aria-valuemin="1"
                aria-valuemax="5"
                aria-valuenow="1"
              >
                <div
                  id="progressBar"
                  class="progress-bar"
                  style="width: 25%"
                ></div>
              </div>
            </div>

            <form id="orderForm" novalidate>
              <!-- Step 1: About You -->
              <section
                id="step1"
                class="order-step"
                aria-labelledby="step1_title"
              >
                <div class="section-title section-title-center">
                  <h3 class="wow fadeInUp">Step 1</h3>
                  <h2
                    id="step1_title"
                    class="wow fadeInUp"
                    data-wow-delay="0.1s"
                    data-cursor="-opaque"
                    style="margin: 40px 0px"
                  >
                    About <span>you</span>
                  </h2>
                </div>
                <div class="contact-us-form">
                  <div class="row">
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="firstName"
                        >First name or nickname</label
                      >
                      <input type="text" class="form-control" id="firstName" />
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="email"
                        >Email <span aria-hidden="true">*</span></label
                      >
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        required
                      />
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="pronouns">Pronouns</label>
                      <select id="pronouns" class="form-control">
                        <option value="">Select</option>
                        <option value="she/her">She/Her</option>
                        <option value="he/him">He/Him</option>
                        <option value="they/them">They/Them</option>
                        <option value="self-describe">Self-Describe</option>
                        <option value="prefer-not">Prefer Not to Say</option>
                      </select>
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="country">Country</label>
                      <input type="text" class="form-control" id="country" />
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="timezone">Timezone</label>
                      <input
                        type="text"
                        class="form-control"
                        id="timezone"
                        aria-describedby="tz_help"
                      />
                      <small id="tz_help" class="text-muted"
                        >Auto-detected; you can edit.</small
                      >
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="attractedTo"
                        >Who are you attracted to?</label
                      >
                      <select id="attractedTo" class="form-control">
                        <option value="all-genders">All Genders</option>
                        <option value="women">Women</option>
                        <option value="men">Men</option>
                        <option value="non-binary">Non-Binary</option>
                      </select>
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="ageRange"
                        >Your age range</label
                      >
                      <select id="ageRange" class="form-control">
                        <option value="">Select</option>
                        <option value="18-24">18–24</option>
                        <option value="25-34">25–34</option>
                        <option value="35-44">35–44</option>
                        <option value="45-54">45–54</option>
                        <option value="55+">55+</option>
                      </select>
                    </div>
                  </div>
                  <small class="text-muted d-block mt-2"
                    >Why we ask: Helps tailor facial cues and presentation;
                    email is needed for delivery.</small
                  >
                </div>
                <div class="what-we-btn order-nav" style="margin: 40px 0px; display: flex; justify-content: flex-end;">
                  <button type="button" class="btn-default next">Next</button>
                </div>
              </section>

              <!-- Step 2: Birth & Spiritual Insights -->
              <section
                id="step2"
                class="order-step"
                aria-labelledby="step2_title"
                style="display: none"
              >
                <div class="section-title section-title-center">
                  <h3>Step 2</h3>
                  <h2
                    id="step2_title"
                    data-cursor="-opaque"
                    style="margin: 40px 0px"
                  >
                    Birth & <span>Spiritual</span> Insights
                  </h2>
                </div>
                <div class="contact-us-form">
                  <div class="row">
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="birthDate"
                        >Date of birth</label
                      >
                      <input type="date" class="form-control" id="birthDate" />
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="birthTime"
                        >Time of birth</label
                      >
                      <input type="time" class="form-control" id="birthTime" />
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="birthCity"
                        >Birth city</label
                      >
                      <input type="text" class="form-control" id="birthCity" />
                    </div>
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="zodiac"
                        >Derived zodiac</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="zodiac"
                        readonly
                      />
                    </div>
                  </div>
                  <div
                    class="form-group col-md-6 mb-4 d-flex align-items-center"
                  >
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="includeReading"
                      />
                      <label class="form-check-label" for="includeReading"
                        >Include spiritual reading</label
                      >
                    </div>
                  </div>
                  <small class="text-muted d-block mt-2"
                    >Why we ask: Inspires the energy palette and optional
                    reading.</small
                  >
                </div>
                <div class="what-we-btn order-nav" style="margin: 40px 0px">
                  <button type="button" class="btn-default back">Back</button>
                  <button id="reserveBtn" type="button" class="btn-default next">Generate your sketch</button>
                </div>
              </section>

              

              <!-- Step 3: Personality & Lifestyle -->
              <section
                id="step3"
                class="order-step"
                aria-labelledby="step3_title"
                style="display: none"
              >
                <div class="section-title section-title-center">
                  <h3>Step 3</h3>
                  <h2
                    id="step3_title"
                    data-cursor="-opaque"
                    style="margin: 40px 0px"
                  >
                    Personality & <span>Lifestyle</span>
                  </h2>
                </div>
                <div class="contact-us-form">
                  <div class="row">
                    <div class="form-group col-md-4 mb-4">
                      <label class="form-label" for="slider_introvert"
                        >Introverted ↔ Extroverted</label
                      >
                      <input
                        id="slider_introvert"
                        type="range"
                        min="0"
                        max="100"
                        step="1"
                        class="form-range"
                      />
                    </div>
                    <div class="form-group col-md-4 mb-4">
                      <label class="form-label" for="slider_grounded"
                        >Grounded ↔ Adventurous</label
                      >
                      <input
                        id="slider_grounded"
                        type="range"
                        min="0"
                        max="100"
                        step="1"
                        class="form-range"
                      />
                    </div>
                    <div class="form-group col-md-4 mb-4">
                      <label class="form-label" for="slider_analytical"
                        >Analytical ↔ Creative</label
                      >
                      <input
                        id="slider_analytical"
                        type="range"
                        min="0"
                        max="100"
                        step="1"
                        class="form-range"
                      />
                    </div>
                    <div class="form-group col-md-12 mb-4">
                      <label class="form-label">Love languages</label>
                      <div class="row">
                        <div class="col-md-4">
                          <label for="ll_words" class="form-label">Words</label
                          ><input
                            id="ll_words"
                            type="range"
                            min="0"
                            max="100"
                            step="1"
                            class="form-range"
                          />
                        </div>
                        <div class="col-md-4">
                          <label for="ll_qualityTime" class="form-label"
                            >Quality time</label
                          ><input
                            id="ll_qualityTime"
                            type="range"
                            min="0"
                            max="100"
                            step="1"
                            class="form-range"
                          />
                        </div>
                        <div class="col-md-4">
                          <label for="ll_gifts" class="form-label">Gifts</label
                          ><input
                            id="ll_gifts"
                            type="range"
                            min="0"
                            max="100"
                            step="1"
                            class="form-range"
                          />
                        </div>
                        <div class="col-md-4">
                          <label for="ll_acts" class="form-label">Acts</label
                          ><input
                            id="ll_acts"
                            type="range"
                            min="0"
                            max="100"
                            step="1"
                            class="form-range"
                          />
                        </div>
                        <div class="col-md-4">
                          <label for="ll_touch" class="form-label">Touch</label
                          ><input
                            id="ll_touch"
                            type="range"
                            min="0"
                            max="100"
                            step="1"
                            class="form-range"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="form-group col-md-12 mb-4">
                      <label class="form-label">Values (choose any)</label>
                      <div class="row">
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="family"
                              id="val_family"
                            /><label class="form-check-label" for="val_family"
                              >Family</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="growth"
                              id="val_growth"
                            /><label class="form-check-label" for="val_growth"
                              >Growth</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="stability"
                              id="val_stability"
                            /><label
                              class="form-check-label"
                              for="val_stability"
                              >Stability</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="kindness"
                              id="val_kindness"
                            /><label class="form-check-label" for="val_kindness"
                              >Kindness</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="spirituality"
                              id="val_spirituality"
                            /><label
                              class="form-check-label"
                              for="val_spirituality"
                              >Spirituality</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="ambition"
                              id="val_ambition"
                            /><label class="form-check-label" for="val_ambition"
                              >Ambition</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="humor"
                              id="val_humor"
                            /><label class="form-check-label" for="val_humor"
                              >Humor</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="health"
                              id="val_health"
                            /><label class="form-check-label" for="val_health"
                              >Health</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="curiosity"
                              id="val_curiosity"
                            /><label
                              class="form-check-label"
                              for="val_curiosity"
                              >Curiosity</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="service"
                              id="val_service"
                            /><label class="form-check-label" for="val_service"
                              >Service</label
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <small class="text-muted d-block mt-2"
                    >Why we ask: Shapes expression/vibe and line style
                    choices.</small
                  >
                </div>
                <div class="what-we-btn order-nav" style="margin: 40px 0px">
                  <button type="button" class="btn-default back">Back</button>
                  <button type="button" class="btn-default skip">Skip</button>
                  <button type="button" class="btn-default next">Next</button>
                </div>
              </section>

              <!-- Step 4: Relationship Goals & Boundaries -->
              <section
                id="step4"
                class="order-step"
                aria-labelledby="step4_title"
                style="display: none"
              >
                <div class="section-title section-title-center">
                  <h3>Step 4</h3>
                  <h2
                    id="step4_title"
                    data-cursor="-opaque"
                    style="margin: 40px 0px"
                  >
                    Relationship <span>Goals</span> & Boundaries
                  </h2>
                </div>
                <div class="contact-us-form">
                  <div class="row">
                    <div class="form-group col-md-6 mb-4">
                      <label class="form-label" for="lookingFor"
                        >Looking for</label
                      >
                      <select id="lookingFor" class="form-control">
                        <option value="serious">Serious relationship</option>
                        <option value="companionship">Companionship</option>
                        <option value="marriage-minded">Marriage‑minded</option>
                        <option value="exploring">Still exploring</option>
                      </select>
                    </div>
                    <div class="form-group col-md-12 mb-4">
                      <label class="form-label">Must‑haves</label>
                      <div class="row">
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="wants-kids"
                              id="mh_kids"
                            /><label class="form-check-label" for="mh_kids"
                              >Wants Kids</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="pet-friendly"
                              id="mh_pet"
                            /><label class="form-check-label" for="mh_pet"
                              >Pet‑Friendly</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="non-smoker"
                              id="mh_smoke"
                            /><label class="form-check-label" for="mh_smoke"
                              >Non‑Smoker</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="active-lifestyle"
                              id="mh_active"
                            /><label class="form-check-label" for="mh_active"
                              >Active Lifestyle</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="spiritual-openness"
                              id="mh_spirit"
                            /><label class="form-check-label" for="mh_spirit"
                              >Spiritual Openness</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="career-driven"
                              id="mh_career"
                            /><label class="form-check-label" for="mh_career"
                              >Career‑Driven</label
                            >
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              value="family-oriented"
                              id="mh_family"
                            /><label class="form-check-label" for="mh_family"
                              >Family‑Oriented</label
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group col-md-12 mb-4">
                      <label class="form-label" for="dealBreakers"
                        >Deal‑breakers (optional)</label
                      >
                      <textarea
                        id="dealBreakers"
                        rows="3"
                        class="form-control"
                      ></textarea>
                    </div>
                  </div>
                  <small class="text-muted d-block mt-2"
                    >Why we ask: Calibrates intent and maturity cues in
                    depiction and reading.</small
                  >
                </div>
                <div class="what-we-btn order-nav" style="margin: 40px 0px">
                  <button type="button" class="btn-default back">Back</button>
                  <button type="button" class="btn-default skip">Skip</button>
                  <button type="button" class="btn-default next" onclick="event.preventDefault(); event.stopPropagation(); console.log('Step4b Next clicked, currentStep:', currentStep); goToStep(5); return false;">Proceed to Checkout</button>
                </div>
              </section>

              <!-- Step 5: Payment -->
              <section
                id="step5"
                class="order-step"
                aria-labelledby="step5_title"
                style="display: none"
              >
                <div class="section-title section-title-center">
                  <h3>Step 5</h3>
                  <h2
                    id="step5_title"
                    data-cursor="-opaque"
                    style="margin: 40px 0px"
                  >
                    Secure <span>Checkout</span>
                  </h2>
                  <p style="margin-bottom: 30px; color: var(--primary-color);">
                    Complete your order to receive your personalized soulmate sketch and reading within 24 hours.
                  </p>
                </div>

                <!-- Pricing Summary -->
                <div class="payment-summary" style="background: var(--section-bg-color); border-radius: 12px; padding: 30px; margin-bottom: 30px; border: 1px solid var(--divider-color);">
                  <h4 style="margin-bottom: 20px; font-size: 18px;">Order Summary</h4>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span>Premium Soulmate Sketch + Reading</span>
                    <strong style="font-size: 20px; color: var(--accent-color);">$17.99</strong>
                    </div>
                  <hr style="border-color: var(--divider-color); margin: 20px 0;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <strong>Total</strong>
                    <strong style="font-size: 24px; color: var(--accent-color);">$17.99</strong>
                    </div>
                  <div style="margin-top: 15px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                    <small style="color: var(--primary-color);">
                      ✨ Includes: High-resolution soulmate sketch, detailed PDF reading, and 24-hour delivery
                    </small>
                          </div>
                        </div>

                <!-- Payment Form -->
                <div class="payment-form">
                  <form id="payment-form">
                    <!-- Stripe Elements will be mounted here -->
                    <div id="payment-element" style="margin-bottom: 20px;"></div>
                    
                    <!-- Payment Options -->
                    <div style="margin: 20px 0;">
                      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                        <svg style="width: 24px; height: 24px; fill: currentColor;" viewBox="0 0 24 24">
                          <path d="M18.71 19.5C17.88 20.74 17 21.95 15.66 21.97C14.32 22 13.89 21.18 12.37 21.18C10.84 21.18 10.37 21.95 9.1 22C7.79 22.05 6.8 20.68 5.96 19.47C4.25 17 2.94 12.45 4.7 9.39C5.57 7.87 7.13 6.91 8.82 6.88C10.1 6.86 11.32 7.75 12.11 7.75C12.89 7.75 14.37 6.68 15.92 6.84C16.57 6.87 18.39 7.1 19.56 8.82C19.47 8.88 17.39 10.1 17.41 12.63C17.44 15.65 20.06 16.66 20.09 16.67C20.06 16.74 19.67 18.11 18.71 19.5M13 3.5C13.73 2.67 14.94 2.04 15.94 2C16.07 3.17 15.6 4.35 14.9 5.19C14.21 6.04 13.07 6.7 11.95 6.61C11.8 5.46 12.36 4.26 13 3.5Z"/>
                        </svg>
                        <span style="color: var(--primary-color); font-weight: 500;">Apple Pay supported</span>
                      </div>
                      
                      <div style="display: flex; gap: 15px; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <!-- Visa -->
                        <div style="background: white; padding: 4px 8px; border-radius: 4px;">
                          <svg style="height: 16px; width: 50px;" viewBox="0 0 156 50">
                            <path fill="#1A1F71" d="M34.216 33.114l-4.552-21.42h-7.284l11.484 28.572h6.708l11.484-28.572h-7.284l-4.552 21.42h-6.004z"/>
                            <path fill="#1A1F71" d="M66.012 11.694c-1.44-.576-3.708-.864-6.804-.864-7.5 0-12.78 3.996-12.816 9.72-.036 4.248 3.78 6.624 6.672 8.028 2.964 1.44 3.96 2.376 3.96 3.672-.036 1.98-2.376 2.88-4.572 2.88-3.06 0-4.68-.432-7.2-1.512l-.972-.468-1.08 6.624c1.8.828 5.148 1.548 8.604 1.584 7.992 0 13.176-3.924 13.212-10.008.036-3.384-2.016-5.94-6.444-8.064-2.664-1.368-4.284-2.304-4.284-3.708.036-1.26 1.404-2.556 4.428-2.556 2.52-.036 4.356.54 5.76 1.152l.684.324 1.044-6.408z"/>
                            <path fill="#1A1F71" d="M84.708 11.694h-5.616c-1.764 0-3.06.504-3.816 2.376l-10.8 26.196h7.956c0 0 1.296-3.6 1.584-4.392h9.756c.216 1.044.9 4.392.9 4.392h7.02l-6.12-28.572h-.864zm-8.352 18.036c.612-1.656 2.988-8.028 2.988-8.028s.612-1.656.972-2.736l.504 2.484s1.404 6.732 1.692 8.28h-6.156z"/>
                            <path fill="#1A1F71" d="M18.756 11.694l-7.2 19.476-.756-3.888c-1.296-4.392-5.364-9.18-9.9-11.556l6.516 24.54h8.028L28.404 11.694h-9.648z"/>
                            <path fill="#F7B600" d="M7.2 11.694H.252l-.072.432c9.54 2.448 15.876 8.352 18.504 15.444L15.876 14.07c-.54-2.088-2.088-3.24-3.96-3.384L7.2 11.694z"/>
                          </svg>
                        </div>
                        
                        <!-- Mastercard -->
                        <div style="background: white; padding: 4px 8px; border-radius: 4px;">
                          <svg style="height: 16px; width: 26px;" viewBox="0 0 50 31">
                            <circle fill="#EB001B" cx="15.5" cy="15.5" r="15.5"/>
                            <circle fill="#F79E1B" cx="34.5" cy="15.5" r="15.5"/>
                            <path fill="#FF5F00" d="M31 15.5c0-5.9-2.6-11.2-6.5-14.8C21.6 4.3 19 15.5 19 15.5s2.6 11.2 5.5 14.8C28.4 26.7 31 21.4 31 15.5z"/>
                          </svg>
                        </div>
                        
                        <!-- American Express -->
                        <div style="background: white; padding: 4px 8px; border-radius: 4px;">
                          <svg style="height: 16px; width: 26px;" viewBox="0 0 50 31">
                            <rect fill="#006FCF" width="50" height="31" rx="2"/>
                            <path fill="white" d="M8.5 10.5h3.2l.7 1.7.7-1.7h3.2v8.8h-2.1v-5.4l-.8 2h-1.1l-.8-2v5.4H8.5v-8.8zm15.8 0h-4.5v8.8h4.5v-1.8h-2.4v-1.4h2.3v-1.8h-2.3v-1.9h2.4v-1.9zm2.7 0h2.1l1.2 3.4 1.2-3.4h2.1l-2.3 8.8h-1.9l-2.4-8.8zm10.2 0h2.1v7h2.4v1.8h-4.5v-8.8z"/>
                          </svg>
                        </div>
                        
                        <div style="margin-left: auto;">
                          <span style="font-size: 12px; color: var(--primary-color); display: flex; align-items: center; gap: 5px;">
                            <svg style="width: 16px; height: 16px; fill: #10B981;" viewBox="0 0 24 24">
                              <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                              <path fill="white" d="M10 17l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
                            </svg>
                            Secure SSL encryption
                          </span>
                        </div>
                      </div>
                    </div>

                    <div id="payment-messages" role="alert" style="margin: 15px 0; min-height: 20px;"></div>
                  </form>
                        </div>

                <div class="what-we-btn order-nav" style="margin: 40px 0px">
                  <button type="button" class="btn-default back">Back</button>
                  <button id="submit-payment" type="button" class="btn-default" disabled>
                    <span id="payment-button-text">Complete Order - $17.99</span>
                    <div id="payment-spinner" class="spinner" style="display: none;"></div>
                  </button>
                </div>
              </section>

              
            </form>

            <div
              id="orderComplete"
              class="wow fadeInUp"
              data-wow-delay="0.1s"
              style="display: none"
            >
              <div class="section-title section-title-center">
                <h3>All done</h3>
                <h2 data-cursor="-opaque" style="margin: 40px 0px 0px">
                  You're <span>all set!</span>
                </h2>
              </div>
              <p
                style="
                  display: flex;
                  justify-content: center;
                  margin: 0px 0px 40px;
                "
              >
                Your preferences are saved. Since ordering isn’t open yet, enjoy
                a sample sketch and we’ll notify you when we launch.
              </p>
              <div class="what-we-btn order-complete-nav">
                <a
                  href="images/home/pencil-generated.jpg"
                  class="btn-default"
                  download
                  >Download sample sketch</a
                >
                <a id="mailtoDraft" href="#" class="btn-default"
                  >Subscribe for launch</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Order Wizard End -->

    <!-- Footer Start -->
    <footer class="main-footer bg-section">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <!-- Footer Header Start -->
            <div class="footer-header">
              <!-- Section Title Start -->
              <div class="section-title">
                <h2 data-cursor="-opaque">
                  Start your <span>soulmate sketch</span> today.
                </h2>
              </div>
              <!-- Section Title End -->

              <!-- Our Solutions CIrcle Start -->
              <div class="our-solutions-circle">
                <a href="order.html">
                  <figure>
                    <img src="images/our-solutions-circle.svg" alt="" />
                  </figure>

                  <div class="agency-circle-arrow">
                    <img src="images/arrow-white.svg" alt="" />
                  </div>
                </a>
              </div>
              <!-- Our Solutions CIrcle End -->
            </div>
            <!-- Footer Header End -->
          </div>

          <div class="col-lg-3 col-md-6">
            <!-- About Footer Start -->
            <div class="about-footer">
              <!-- Footer Logo Start -->
              <div class="footer-logo">
                <img
                  src="images/footer-logo.svg"
                  alt="Sketch My Soulmate Footer Logo"
                  style="width: 183px; height: 50px"
                />
              </div>
              <!-- Footer Logo End -->

              <!-- About Footer Content Start -->
              <div class="about-footer-content">
                <p>
                  Personalized soulmate sketches crafted with AI‑assisted
                  artistry — delivered to your inbox within 24 hours.
                </p>
              </div>
              <!-- About Footer Content End -->

              <!-- Footer Social Link Start -->
              <div class="footer-social-links">
                <ul>
                  <li>
                    <a href="index.html#"
                      ><i class="fa-brands fa-facebook-f"></i
                    ></a>
                  </li>
                  <li>
                    <a href="index.html#"
                      ><i class="fa-brands fa-dribbble"></i
                    ></a>
                  </li>
                  <li>
                    <a href="index.html#"
                      ><i class="fa-brands fa-instagram"></i
                    ></a>
                  </li>
                  <li>
                    <a href="index.html#"
                      ><i class="fa-brands fa-linkedin-in"></i
                    ></a>
                  </li>
                </ul>
              </div>
              <!-- Footer Social Link End -->
            </div>
            <!-- About Footer End -->
          </div>

          <div class="col-lg-3 col-md-6">
            <!-- Footer Links Start -->
            <div class="footer-links footer-service-links">
              <h3>Explore</h3>
              <ul>
                <li><a href="how-it-works.html">How It Works</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="pricing.html">Pricing</a></li>
                <li><a href="reviews.html">Reviews</a></li>
              </ul>
            </div>
            <!-- Footer Links End -->
          </div>

          <div class="col-lg-3 col-md-5">
            <!-- Footer Links Start -->
            <div class="footer-links">
              <h3>Contact</h3>

              <!-- Footer Contact Item Start -->
              <div class="footer-contact-item">
                <p>support@soulmatesketch.com</p>
              </div>
              <!-- Footer Contact Item End -->

              <!-- Footer Contact Item Start -->
              <div class="footer-contact-item">
                <p>Need any help?</p>
                <h3><a href="faq.html">Visit FAQ</a></h3>
              </div>
              <!-- Footer Contact Item End -->
            </div>
            <!-- Footer Links End -->
          </div>

          <div class="col-lg-3 col-md-7">
            <!-- Footer Newsletter Start -->
            <div class="footer-links">
              <h3>Subscribe To Newsletter</h3>
              <p>
                Subscribe to our newsletter for the latest updates, exclusive
                content.
              </p>

              <!-- Footer Newsletter Form Start -->
              <div class="footer-newsletter-form">
                <form id="newslettersForm" action="index.html#" method="POST">
                  <div class="form-group">
                    <input
                      type="email"
                      name="mail"
                      class="form-control"
                      id="mail"
                      placeholder="Email Address *"
                      required
                    />
                    <button type="submit" class="btn-default">
                      <img src="images/arrow-white.svg" alt="" />
                    </button>
                  </div>
                </form>
              </div>
              <!-- Footer Newsletter Form End -->
            </div>
            <!-- Footer Newsletter End -->
          </div>

          <div class="col-lg-12">
            <!-- Footer Copyright Text Start -->
            <div class="footer-copyright-text">
              <p>Copyright © 2025 All Rights Reserved.</p>
            </div>
            <!-- Footer Copyright Text End -->
          </div>

          <div class="col-lg-12">
            <div class="footer-disclaimer-text">
              <p>Sketch My Soulmate is for entertainment and inspiration.</p>
            </div>
          </div>

          <div class="col-lg-12">
            <!-- Footer Brand Text Start -->
            <div class="footer-nextmind-text">
              <h2>Sketch My Soulmate.</h2>
            </div>
            <!-- Footer Brand Text End -->
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer End -->

    <!-- Jquery Library File -->
    <script src="js/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap js file -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Validator js file -->
    <script src="js/validator.min.js"></script>
    <!-- SlickNav js file -->
    <script src="js/jquery.slicknav.js"></script>
    <!-- Swiper js file -->
    <script src="js/swiper-bundle.min.js"></script>
    <!-- Counter js file -->
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <!-- Magnific js file -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <!-- Parallax js -->
    <script src="js/parallaxie.js"></script>
    <!-- MagicCursor js file -->
    <script src="js/gsap.min.js"></script>
    <script src="js/magiccursor.js"></script>
    <!-- Text Effect js file -->
    <script src="js/SplitText.js"></script>
    <script src="js/ScrollTrigger.min.js"></script>
    <!-- SmoothScroll -->
    <script src="js/SmoothScroll.js"></script>
    <!-- YTPlayer js File -->
    <script src="js/jquery.mb.YTPlayer.min.js"></script>
    <!-- Wow js file -->
    <script src="js/wow.min.js"></script>
    <!-- Main Custom js file -->
    <script src="js/function.js"></script>
    <script>
      (function () {
        const defaultState = {
          user: {
            firstName: "",
            email: "",
            pronouns: "",
            country: "",
            timezone: "",
            attractedTo: "all-genders",
            ageRange: "",
          },
          birth: {
            date: "",
            time: "",
            city: "",
            zodiac: "",
            includeSpiritualReading: false,
          },
          appearance: {
            faceShape: "no-preference",
            facialHair: "no-preference",
            freckles: "no-preference",
            hairLength: "no-preference",
            hairTexture: "no-preference",
            hairColor: "no-preference",
            eyeColor: "no-preference",
            eyeShape: "no-preference",
            skinTone: "no-preference",
            apparentAge: "no-preference",
            culturalResonance: "",
          },
          personality: {
            introvertExtrovert: 50,
            groundedAdventurous: 50,
            analyticalCreative: 50,
            values: [],
            loveLanguages: {
              words: 20,
              qualityTime: 20,
              gifts: 20,
              acts: 20,
              touch: 20,
            },
          },
          relationship: {
            lookingFor: "serious",
            mustHaves: [],
            dealBreakers: "",
          },
          preferences: {
            artStyle: "pencil-realistic",
            auraPalette: "warm",
            addons: {
              colorUpgrade: false,
              reading: false,
              compatibility: false,
              rush12h: false,
            },
            formats: { jpg: true, pdf: false },
          },
        };

        let state = defaultState;
        let currentStep = 1;

        // Cache DOM
        const stepSections = Array.from(
          document.querySelectorAll(".order-step")
        );
        const progressBar = document.getElementById("progressBar");
        const stepLabel = document.getElementById("stepLabel");

        const orderForm = document.getElementById("orderForm");
        const orderComplete = document.getElementById("orderComplete");
        const mailtoDraft = document.getElementById("mailtoDraft");

        // Init timezone if empty
        try {
          if (!state.user.timezone) {
            state.user.timezone =
              Intl.DateTimeFormat().resolvedOptions().timeZone || "";
          }
        } catch (e) {}

        // Hydrate inputs from state
        syncStateToForm();
        goToStep(currentStep);

        // Input listeners (delegate simple ones)
        orderForm.addEventListener("input", handleInputChange, true);
        orderForm.addEventListener("change", handleInputChange, true);

        // Nav buttons
        orderForm.addEventListener("click", function (e) {
          const t = e.target;
          if (t.classList.contains("next")) {
            console.log('🔵 Next button clicked on step:', currentStep);
            e.preventDefault();
            if (!validateCurrentStep()) {
              console.log('❌ Validation failed for step:', currentStep);
              return;
            }
            console.log('✅ Validation passed, going to next step');
            goToStep(Math.min(5, currentStep + 1));
          }
          if (t.classList.contains("back")) {
            e.preventDefault();
            goToStep(Math.max(1, currentStep - 1));
          }
          if (t.classList.contains("skip")) {
            e.preventDefault();
            goToStep(Math.min(5, currentStep + 1));
          }
        });

        // Stripe initialization
        let stripe, elements, paymentElement;
        
        // Initialize Stripe when entering payment step
        async function initializeStripe() {
          console.log('🔵 Initializing Stripe payment system...');
          try {
            // Replace with your actual Stripe publishable key
            stripe = Stripe('pk_live_51QhI2MR6S5fZy5mLWYNJGLAm9PTXt3BKZlSPBtGJoXBdqGZ0Qw1dSHAY2z1TGvhjHYJAOFjGdFOyOdGXlBJ7x2N400l7YQWkNx');
            console.log('✅ Stripe object created successfully');
          
          const appearance = {
            theme: 'night',
            variables: {
              colorPrimary: '#667eea',
              colorBackground: '#1a1a1a',
              colorText: '#ffffff',
              colorDanger: '#df1b41',
              fontFamily: 'Manrope, system-ui, sans-serif',
              spacingUnit: '4px',
              borderRadius: '8px',
            },
          };

          elements = stripe.elements({
            appearance,
            mode: 'payment',
            amount: 1799, // $17.99 in cents
            currency: 'usd',
            payment_method_types: ['card', 'apple_pay'],
          });

          paymentElement = elements.create('payment');
          console.log('🔵 Mounting payment element to #payment-element...');
          paymentElement.mount('#payment-element');
          console.log('✅ Payment element mounted successfully');

          // Listen for changes in the Element
          paymentElement.on('change', (event) => {
            console.log('🔵 Payment element changed:', event);
            const submitButton = document.getElementById('submit-payment');
            if (event.complete) {
              submitButton.disabled = false;
              console.log('✅ Payment form is complete, enabling submit button');
            } else {
              submitButton.disabled = true;
              console.log('⚠️ Payment form incomplete, submit button disabled');
            }
            
            const messageContainer = document.getElementById('payment-messages');
            if (event.error) {
              messageContainer.textContent = event.error.message;
              messageContainer.style.color = '#df1b41';
              console.log('❌ Payment error:', event.error.message);
            } else {
              messageContainer.textContent = '';
            }
          });
          
          console.log('🎉 Stripe payment system fully initialized!');
          } catch (error) {
            console.error('❌ Failed to initialize Stripe:', error);
          }
        }

        // Handle payment submission
        document.getElementById('submit-payment').addEventListener('click', async function(e) {
          e.preventDefault();
          
          const submitButton = e.target;
          const buttonText = document.getElementById('payment-button-text');
          const spinner = document.getElementById('payment-spinner');
          
          // Show loading state
          submitButton.disabled = true;
          buttonText.style.display = 'none';
          spinner.style.display = 'inline-block';

          try {
            // Create payment intent on backend
            const paymentResponse = await fetch('/api/create-payment-intent', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ 
                amount: 1799, // $17.99 in cents
                currency: 'usd',
                email: state.user.email || 'test@example.com'
              })
            });
            
            if (!paymentResponse.ok) throw new Error('Failed to create payment intent');
            const { client_secret } = await paymentResponse.json();

            // Confirm payment with Stripe
            const {error, paymentIntent} = await stripe.confirmPayment({
              elements,
              clientSecret: client_secret,
              confirmParams: {
                return_url: window.location.origin + '/payment-success',
                payment_method_data: {
                  billing_details: {
                    email: state.user.email || 'test@example.com',
                    name: state.user.firstName || 'Anonymous'
                  }
                }
              },
              redirect: 'if_required'
            });

            if (error) {
              // Payment failed
              document.getElementById('payment-messages').textContent = error.message;
              document.getElementById('payment-messages').style.color = '#df1b41';
              
              // Reset button state
              submitButton.disabled = false;
              buttonText.style.display = 'inline';
              spinner.style.display = 'none';
            } else if (paymentIntent.status === 'succeeded') {
              // Payment succeeded - proceed with order generation
              await processOrderAfterPayment(paymentIntent.id);
            }
          } catch (error) {
            console.error('Payment error:', error);
            document.getElementById('payment-messages').textContent = 'Payment failed. Please try again.';
            document.getElementById('payment-messages').style.color = '#df1b41';
            
            // Reset button state
            submitButton.disabled = false;
            buttonText.style.display = 'inline';
            spinner.style.display = 'none';
          }
        });

        // Process order after successful payment
        async function processOrderAfterPayment(paymentIntentId) {
          try {
            // Build quiz payload from state
            const quiz = {
              user: state.user,
              birth: state.birth,
              appearance: state.appearance,
              personality: state.personality,
              relationship: state.relationship,
              preferences: state.preferences,
              interest: state.user?.attractedTo === 'women' ? 'female' : state.user?.attractedTo === 'men' ? 'male' : 'surprise',
              style: state.preferences?.artStyle || 'pencil-realistic'
            };

            // 1) Create order with payment info
            const createRes = await fetch('/api/orders', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ 
                email: state.user.email || 'test@example.com', 
                tier: 'premium', 
                addons: [],
                paymentIntentId: paymentIntentId,
                amount: 1799
              })
            });
            if (!createRes.ok) throw new Error('Failed to create order');
            const order = await createRes.json();

            // 2) Submit quiz data
            const intakeRes = await fetch(`/api/orders/${order.id}/intake`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ quiz })
            });
            if (!intakeRes.ok) throw new Error('Failed to submit quiz data');

            // 3) Generate deliverables
            const generateRes = await fetch(`/api/orders/${order.id}/generate`, {
              method: 'POST'
            });
            if (!generateRes.ok) throw new Error('Failed to generate deliverables');
            const result = await generateRes.json();

            // Update completion screen
            document.getElementById('downloadSampleSketch').href = '/' + result.pdfPath;
            document.getElementById('viewImage').href = '/' + result.imagePath;
            
            showComplete();
          } catch (error) {
            console.error('Order processing error:', error);
            alert('Payment succeeded but order processing failed. Please contact support with payment ID: ' + paymentIntentId);
          }
        }

        // Override goToStep to initialize Stripe when entering payment step
        const originalGoToStep = goToStep;
        goToStep = function(n) {
          originalGoToStep(n);
          if (n === 5 && !paymentElement) {
            initializeStripe();
          }
        };

        // Submit (generate deliverables) - now only used for testing without payment
        orderForm.addEventListener("submit", function (e) {
          e.preventDefault();
          console.log('Form submit triggered, currentStep:', currentStep);
          
          // Don't process if we're on the payment step - payment handles its own submission
          if (currentStep === 5) {
            console.log('Blocking form submission - on payment step');
            return;
          }
          
          if (!validateCurrentStep(true)) return;

          // Build quiz payload from state
          const quiz = {
            user: state.user,
            birth: state.birth,
            appearance: state.appearance,
            personality: state.personality,
            relationship: state.relationship,
            preferences: state.preferences,
            interest: state.user?.attractedTo === 'women' ? 'female' : state.user?.attractedTo === 'men' ? 'male' : 'surprise',
            style: state.preferences?.artStyle || 'pencil-realistic'
          };

          (async function run() {
            try {
              // 1) Create order
              const createRes = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: state.user.email || 'test@example.com', tier: 'premium', addons: [] })
              });
              if (!createRes.ok) throw new Error('Failed to create order');
              const order = await createRes.json();

              // 2) Submit intake (no photo in this flow)
              const intakeRes = await fetch(`/api/orders/${order.id}/intake`, {
                method: 'POST',
                body: (() => { const f = new FormData(); f.append('quiz', JSON.stringify(quiz)); return f; })()
              });
              if (!intakeRes.ok) throw new Error('Failed to submit intake');

              // 3) Generate deliverables
              const genRes = await fetch(`/api/orders/${order.id}/generate`, { method: 'POST' });
              if (!genRes.ok) throw new Error('Failed to generate');
              const result = await genRes.json();

              // 4) Show results
              // Reuse existing complete section UI
              const downloadBtn = document.querySelector('#orderComplete a[href$="pencil-generated.jpg"]');
              if (downloadBtn && result.pdfPath) downloadBtn.href = '/' + result.pdfPath;
              const subscribeBtn = document.getElementById('mailtoDraft');
              if (subscribeBtn) subscribeBtn.textContent = 'View Image';
              if (subscribeBtn && result.imagePath) subscribeBtn.href = '/' + result.imagePath;
          showComplete();
            } catch (err) {
              alert('Generation failed. Please try again.');
              console.error(err);
            }
          })();
        });

        function handleInputChange(e) {
          const id = e.target.id;
          const el = e.target;
          
          // Map inputs to state
          switch (id) {
            // Step 1
            case "firstName":
              state.user.firstName = el.value || "";
              break;
            case "email":
              state.user.email = el.value || "";
              break;
            case "pronouns":
              state.user.pronouns = el.value || "";
              break;
            case "country":
              state.user.country = el.value || "";
              break;
            case "timezone":
              state.user.timezone = el.value || "";
              break;
            case "attractedTo":
              state.user.attractedTo = el.value || "all-genders";
              break;
            case "ageRange":
              state.user.ageRange = el.value || "";
              break;
            // Step 2
            case "birthDate":
              state.birth.date = el.value || "";
              deriveZodiac();
              break;
            case "birthTime":
              state.birth.time = el.value || "";
              break;
            case "birthCity":
              state.birth.city = el.value || "";
              break;
            case "zodiac":
              state.birth.zodiac = el.value || "";
              break;
            case "includeReading":
              state.birth.includeSpiritualReading = !!el.checked;
              break;
            // Step 3
            case "faceShape":
              state.appearance.faceShape = el.value;
              break;
            case "facialHair":
              state.appearance.facialHair = el.value;
              break;
            case "freckles":
              state.appearance.freckles = el.value;
              break;
            case "hairLength":
              state.appearance.hairLength = el.value;
              break;
            case "hairTexture":
              state.appearance.hairTexture = el.value;
              break;
            case "hairColor":
              state.appearance.hairColor = el.value;
              break;
            case "eyeColor":
              state.appearance.eyeColor = el.value;
              break;
            case "eyeShape":
              state.appearance.eyeShape = el.value;
              break;
            case "skinTone":
              state.appearance.skinTone = el.value;
              break;
            case "apparentAge":
              state.appearance.apparentAge = el.value;
              break;
            case "culturalResonance":
              state.appearance.culturalResonance = el.value || "";
              break;
            // Step 4
            case "slider_introvert":
              state.personality.introvertExtrovert = parseInt(
                el.value || "50",
                10
              );
              break;
            case "slider_grounded":
              state.personality.groundedAdventurous = parseInt(
                el.value || "50",
                10
              );
              break;
            case "slider_analytical":
              state.personality.analyticalCreative = parseInt(
                el.value || "50",
                10
              );
              break;
            case "ll_words":
              state.personality.loveLanguages.words = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_qualityTime":
              state.personality.loveLanguages.qualityTime = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_gifts":
              state.personality.loveLanguages.gifts = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_acts":
              state.personality.loveLanguages.acts = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_touch":
              state.personality.loveLanguages.touch = parseInt(
                el.value || "20",
                10
              );
              break;
            // Step 5 handled by checkbox listeners below
            case "lookingFor":
              state.relationship.lookingFor = el.value;
              break;
            case "dealBreakers":
              state.relationship.dealBreakers = el.value || "";
              break;
            // Step 6
            case "artStyle":
              state.preferences.artStyle = el.value;
              break;
            case "auraPalette":
              state.preferences.auraPalette = el.value;
              break;
            case "addon_color":
              state.preferences.addons.colorUpgrade = !!el.checked;
              break;
            case "addon_reading":
              state.preferences.addons.reading = !!el.checked;
              break;
            case "addon_compat":
              state.preferences.addons.compatibility = !!el.checked;
              break;
            case "addon_rush":
              state.preferences.addons.rush12h = !!el.checked;
              break;
            case "fmt_jpg":
              state.preferences.formats.jpg = !!el.checked;
              break;
            case "fmt_pdf":
              state.preferences.formats.pdf = !!el.checked;
              break;
          }

          // Step 4 values multi-select (checkboxes)
          if (id && id.startsWith("val_")) {
            const value = el.value;
            const list = new Set(state.personality.values);
            if (el.checked) list.add(value);
            else list.delete(value);
            state.personality.values = Array.from(list);
          }

          // Step 5 must-haves
          if (
            [
              "mh_kids",
              "mh_pet",
              "mh_smoke",
              "mh_active",
              "mh_spirit",
              "mh_career",
              "mh_family",
            ].includes(id)
          ) {
            const mhMap = {
              mh_kids: "non-empty:wants-kids",
              mh_pet: "non-empty:pet-friendly",
              mh_smoke: "non-empty:non-smoker",
              mh_active: "non-empty:active-lifestyle",
              mh_spirit: "non-empty:spiritual-openness",
              mh_career: "non-empty:career-driven",
              mh_family: "non-empty:family-oriented",
            };
            const value = mhMap[id].split(":")[1];
            const set = new Set(state.relationship.mustHaves);
            if (el.checked) set.add(value);
            else set.delete(value);
            state.relationship.mustHaves = Array.from(set);
          }

          if (id === "birthDate") syncStateToForm(["zodiac"]);
        }

        function deriveZodiac() {
          if (!state.birth.date) {
            state.birth.zodiac = "";
            return;
          }
          try {
            const d = new Date(state.birth.date + "T12:00:00");
            const m = d.getUTCMonth() + 1;
            const day = d.getUTCDate();
            // Simple western zodiac ranges (approximate)
            const z =
              (m == 3 && day >= 21) || (m == 4 && day <= 19)
                ? "Aries"
                : (m == 4 && day >= 20) || (m == 5 && day <= 20)
                ? "Taurus"
                : (m == 5 && day >= 21) || (m == 6 && day <= 20)
                ? "Gemini"
                : (m == 6 && day >= 21) || (m == 7 && day <= 22)
                ? "Cancer"
                : (m == 7 && day >= 23) || (m == 8 && day <= 22)
                ? "Leo"
                : (m == 8 && day >= 23) || (m == 9 && day <= 22)
                ? "Virgo"
                : (m == 9 && day >= 23) || (m == 10 && day <= 22)
                ? "Libra"
                : (m == 10 && day >= 23) || (m == 11 && day <= 21)
                ? "Scorpio"
                : (m == 11 && day >= 22) || (m == 12 && day <= 21)
                ? "Sagittarius"
                : (m == 12 && day >= 22) || (m == 1 && day <= 19)
                ? "Capricorn"
                : (m == 1 && day >= 20) || (m == 2 && day <= 18)
                ? "Aquarius"
                : "Pisces";
            state.birth.zodiac = z;
          } catch (e) {
            state.birth.zodiac = "";
          }
        }

        function goToStep(n) {
          console.log(`goToStep called: going to step ${n}, current step was ${currentStep}`);
          currentStep = n;

          stepSections.forEach((s, i) => {
            const shouldShow = i + 1 === n;
            s.style.display = shouldShow ? "block" : "none";
            if (shouldShow) {
              console.log(`Showing step section: ${s.id} (index ${i})`);
            }
          });
          const pct = Math.round((n / 5) * 100);
          progressBar.style.width = pct + "%";
          progressBar.parentElement.setAttribute("aria-valuenow", String(n));
          stepLabel.textContent = `Step ${n} of 5 — ${getStepLabel(n)}`;
          
          console.log(`Step ${n} should now be visible. Step sections:`, stepSections.map(s => `${s.id}: ${s.style.display}`));
        }

        function getStepLabel(n) {
          return (
            [
              "About you",
              "Birth & spiritual insights",
              "Personality & lifestyle",
              "Relationship goals",
              "Secure checkout",
            ][n - 1] || ""
          );
        }

        function validateCurrentStep(isSubmit) {
          console.log('🔍 Validating step:', currentStep, 'State:', state);
          
          if (currentStep === 1) {
            const email = (state.user.email || "").trim();
            console.log('🔍 Email validation - current email:', email);
            const ok = /.+@.+\..+/.test(email);
            console.log('🔍 Email validation result:', ok);
            if (!ok) {
              console.log('❌ Email validation failed');
              alert("Please enter a valid email address to continue.");
              return false;
            }
            console.log('✅ Email validation passed');
          }

          console.log('✅ Step validation completed successfully');
          return true;
        }

        function syncStateToForm(only) {
          const ids = new Set(only || []);
          function setVal(id, val) {
            const el = document.getElementById(id);
            if (!el) return;
            if (el.type === "checkbox") el.checked = !!val;
            else el.value = val == null ? "" : String(val);
          }
          setVal("firstName", state.user.firstName);
          setVal("email", state.user.email);
          setVal("pronouns", state.user.pronouns);
          setVal("country", state.user.country);
          setVal("timezone", state.user.timezone);
          setVal("attractedTo", state.user.attractedTo);
          setVal("ageRange", state.user.ageRange);
          setVal("birthDate", state.birth.date);
          setVal("birthTime", state.birth.time);
          setVal("birthCity", state.birth.city);
          setVal("zodiac", state.birth.zodiac);
          setVal("includeReading", state.birth.includeSpiritualReading);
          setVal("faceShape", state.appearance.faceShape);
          setVal("facialHair", state.appearance.facialHair);
          setVal("freckles", state.appearance.freckles);
          setVal("hairLength", state.appearance.hairLength);
          setVal("hairTexture", state.appearance.hairTexture);
          setVal("hairColor", state.appearance.hairColor);
          setVal("eyeColor", state.appearance.eyeColor);
          setVal("eyeShape", state.appearance.eyeShape);
          setVal("skinTone", state.appearance.skinTone);
          setVal("apparentAge", state.appearance.apparentAge);
          setVal("culturalResonance", state.appearance.culturalResonance);
          setVal("slider_introvert", state.personality.introvertExtrovert);
          setVal("slider_grounded", state.personality.groundedAdventurous);
          setVal("slider_analytical", state.personality.analyticalCreative);
          setVal("ll_words", state.personality.loveLanguages.words);
          setVal("ll_qualityTime", state.personality.loveLanguages.qualityTime);
          setVal("ll_gifts", state.personality.loveLanguages.gifts);
          setVal("ll_acts", state.personality.loveLanguages.acts);
          setVal("ll_touch", state.personality.loveLanguages.touch);
          
          // values checkboxes
          [
            "family",
            "growth",
            "stability",
            "kindness",
            "spirituality",
            "ambition",
            "humor",
            "health",
            "curiosity",
            "service",
          ].forEach((v) => {
            const el = document.getElementById("val_" + v);
            if (el) el.checked = (state.personality.values || []).includes(v);
          });
          
          // must‑haves
          const mh = new Set(state.relationship.mustHaves || []);
          const map = {
            mh_kids: "wants-kids",
            mh_pet: "pet-friendly",
            mh_smoke: "non-smoker",
            mh_active: "active-lifestyle",
            mh_spirit: "spiritual-openness",
            mh_career: "career-driven",
            mh_family: "family-oriented",
          };
          Object.keys(map).forEach((id) => {
            const el = document.getElementById(id);
            if (el) el.checked = mh.has(map[id]);
          });
          
          // step 6 formats/addons - only set if elements exist
          setVal("artStyle", state.preferences.artStyle);
          setVal("auraPalette", state.preferences.auraPalette);
          
          const addonColor = document.getElementById("addon_color");
          if (addonColor) addonColor.checked = !!state.preferences.addons.colorUpgrade;
          
          const addonReading = document.getElementById("addon_reading");
          if (addonReading) addonReading.checked = !!state.preferences.addons.reading;
          
          const addonCompat = document.getElementById("addon_compat");
          if (addonCompat) addonCompat.checked = !!state.preferences.addons.compatibility;
          
          const addonRush = document.getElementById("addon_rush");
          if (addonRush) addonRush.checked = !!state.preferences.addons.rush12h;
          
          const fmtJpg = document.getElementById("fmt_jpg");
          if (fmtJpg) fmtJpg.checked = !!state.preferences.formats.jpg;
          
          const fmtPdf = document.getElementById("fmt_pdf");
          if (fmtPdf) fmtPdf.checked = !!state.preferences.formats.pdf;
        }

        function showComplete() {
          // Build mailto link
          try {
            const subject = encodeURIComponent(
              "Sketch My Soulmate — Subscribe for launch"
            );
            const body = encodeURIComponent(
              "Draft data (JSON):\n\n" + JSON.stringify(state, null, 2)
            );
            mailtoDraft.href =
              "mailto:support@soulmatesketch.com?subject=" +
              subject +
              "&body=" +
              body;
          } catch (e) {}
          orderForm.style.display = "none";
          orderComplete.style.display = "block";
        }

        function escapeHtml(s) {
          return String(s).replace(
            /[&<>"']/g,
            (c) =>
              ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#039;",
              }[c])
          );
        }
      })();
    </script>
  </body>
</html>
attractedTo = el.value || "all-genders";
              break;
            case "ageRange":
              state.user.ageRange = el.value || "";
              break;
            // Step 2
            case "birthDate":
              state.birth.date = el.value || "";
              deriveZodiac();
              break;
            case "birthTime":
              state.birth.time = el.value || "";
              break;
            case "birthCity":
              state.birth.city = el.value || "";
              break;
            case "zodiac":
              state.birth.zodiac = el.value || "";
              break;
            case "includeReading":
              state.birth.includeSpiritualReading = !!el.checked;
              break;
            // Step 3
            case "faceShape":
              state.appearance.faceShape = el.value;
              break;
            case "facialHair":
              state.appearance.facialHair = el.value;
              break;
            case "freckles":
              state.appearance.freckles = el.value;
              break;
            case "hairLength":
              state.appearance.hairLength = el.value;
              break;
            case "hairTexture":
              state.appearance.hairTexture = el.value;
              break;
            case "hairColor":
              state.appearance.hairColor = el.value;
              break;
            case "eyeColor":
              state.appearance.eyeColor = el.value;
              break;
            case "eyeShape":
              state.appearance.eyeShape = el.value;
              break;
            case "skinTone":
              state.appearance.skinTone = el.value;
              break;
            case "apparentAge":
              state.appearance.apparentAge = el.value;
              break;
            case "culturalResonance":
              state.appearance.culturalResonance = el.value || "";
              break;
            // Step 4
            case "slider_introvert":
              state.personality.introvertExtrovert = parseInt(
                el.value || "50",
                10
              );
              break;
            case "slider_grounded":
              state.personality.groundedAdventurous = parseInt(
                el.value || "50",
                10
              );
              break;
            case "slider_analytical":
              state.personality.analyticalCreative = parseInt(
                el.value || "50",
                10
              );
              break;
            case "ll_words":
              state.personality.loveLanguages.words = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_qualityTime":
              state.personality.loveLanguages.qualityTime = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_gifts":
              state.personality.loveLanguages.gifts = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_acts":
              state.personality.loveLanguages.acts = parseInt(
                el.value || "20",
                10
              );
              break;
            case "ll_touch":
              state.personality.loveLanguages.touch = parseInt(
                el.value || "20",
                10
              );
              break;
            // Step 5 handled by checkbox listeners below
            case "lookingFor":
              state.relationship.lookingFor = el.value;
              break;
            case "dealBreakers":
              state.relationship.dealBreakers = el.value || "";
              break;
            // Step 6
            case "artStyle":
              state.preferences.artStyle = el.value;
              break;
            case "auraPalette":
              state.preferences.auraPalette = el.value;
              break;
            case "addon_color":
              state.preferences.addons.colorUpgrade = !!el.checked;
              break;
            case "addon_reading":
              state.preferences.addons.reading = !!el.checked;
              break;
            case "addon_compat":
              state.preferences.addons.compatibility = !!el.checked;
              break;
            case "addon_rush":
              state.preferences.addons.rush12h = !!el.checked;
              break;
            case "fmt_jpg":
              state.preferences.formats.jpg = !!el.checked;
              break;
            case "fmt_pdf":
              state.preferences.formats.pdf = !!el.checked;
              break;
          }

          // Step 4 values multi-select (checkboxes)
          if (id && id.startsWith("val_")) {
            const value = el.value;
            const list = new Set(state.personality.values);
            if (el.checked) list.add(value);
            else list.delete(value);
            state.personality.values = Array.from(list);
          }

          // Step 5 must-haves
          if (
            [
              "mh_kids",
              "mh_pet",
              "mh_smoke",
              "mh_active",
              "mh_spirit",
              "mh_career",
              "mh_family",
            ].includes(id)
          ) {
            const mhMap = {
              mh_kids: "non-empty:wants-kids",
              mh_pet: "non-empty:pet-friendly",
              mh_smoke: "non-empty:non-smoker",
              mh_active: "non-empty:active-lifestyle",
              mh_spirit: "non-empty:spiritual-openness",
              mh_career: "non-empty:career-driven",
              mh_family: "non-empty:family-oriented",
            };
            const value = mhMap[id].split(":")[1];
            const set = new Set(state.relationship.mustHaves);
            if (el.checked) set.add(value);
            else set.delete(value);
            state.relationship.mustHaves = Array.from(set);
          }

          if (id === "birthDate") syncStateToForm(["zodiac"]);
        }

        function deriveZodiac() {
          if (!state.birth.date) {
            state.birth.zodiac = "";
            return;
          }
          try {
            const d = new Date(state.birth.date + "T12:00:00");
            const m = d.getUTCMonth() + 1;
            const day = d.getUTCDate();
            // Simple western zodiac ranges (approximate)
            const z =
              (m == 3 && day >= 21) || (m == 4 && day <= 19)
                ? "Aries"
                : (m == 4 && day >= 20) || (m == 5 && day <= 20)
                ? "Taurus"
                : (m == 5 && day >= 21) || (m == 6 && day <= 20)
                ? "Gemini"
                : (m == 6 && day >= 21) || (m == 7 && day <= 22)
                ? "Cancer"
                : (m == 7 && day >= 23) || (m == 8 && day <= 22)
                ? "Leo"
                : (m == 8 && day >= 23) || (m == 9 && day <= 22)
                ? "Virgo"
                : (m == 9 && day >= 23) || (m == 10 && day <= 22)
                ? "Libra"
                : (m == 10 && day >= 23) || (m == 11 && day <= 21)
                ? "Scorpio"
                : (m == 11 && day >= 22) || (m == 12 && day <= 21)
                ? "Sagittarius"
                : (m == 12 && day >= 22) || (m == 1 && day <= 19)
                ? "Capricorn"
                : (m == 1 && day >= 20) || (m == 2 && day <= 18)
                ? "Aquarius"
                : "Pisces";
            state.birth.zodiac = z;
          } catch (e) {
            state.birth.zodiac = "";
          }
        }

        function goToStep(n) {
          console.log(`goToStep called: going to step ${n}, current step was ${currentStep}`);
          currentStep = n;

          stepSections.forEach((s, i) => {
            const shouldShow = i + 1 === n;
            s.style.display = shouldShow ? "block" : "none";
            if (shouldShow) {
              console.log(`Showing step section: ${s.id} (index ${i})`);
            }
          });
          const pct = Math.round((n / 5) * 100);
          progressBar.style.width = pct + "%";
          progressBar.parentElement.setAttribute("aria-valuenow", String(n));
          stepLabel.textContent = `Step ${n} of 5 — ${getStepLabel(n)}`;
          
          console.log(`Step ${n} should now be visible. Step sections:`, stepSections.map(s => `${s.id}: ${s.style.display}`));
          
          // Initialize Stripe when entering payment step
          if (n === 5 && !stripeInitialized) {
            initializeStripe();
          }
        }

        function getStepLabel(n) {
          return (
            [
              "About you",
              "Birth & spiritual insights",
              "Personality & lifestyle",
              "Relationship goals",
              "Secure checkout",
            ][n - 1] || ""
          );
        }

        function validateCurrentStep(isSubmit) {
          console.log('🔍 Validating step:', currentStep, 'State:', state);
          
          if (currentStep === 1) {
            const email = (state.user.email || "").trim();
            console.log('🔍 Email validation - current email:', email);
            const ok = /.+@.+\..+/.test(email);
            console.log('🔍 Email validation result:', ok);
            if (!ok) {
              console.log('❌ Email validation failed');
              alert("Please enter a valid email address to continue.");
              return false;
            }
            console.log('✅ Email validation passed');
          }

          console.log('✅ Step validation completed successfully');
          return true;
        }

        function syncStateToForm(only) {
          const ids = new Set(only || []);
          function setVal(id, val) {
            const el = document.getElementById(id);
            if (!el) return;
            if (el.type === "checkbox") el.checked = !!val;
            else el.value = val == null ? "" : String(val);
          }
          setVal("firstName", state.user.firstName);
          setVal("email", state.user.email);
          setVal("pronouns", state.user.pronouns);
          setVal("country", state.user.country);
          setVal("timezone", state.user.timezone);
          setVal("attractedTo", state.user.attractedTo);
          setVal("ageRange", state.user.ageRange);
          setVal("birthDate", state.birth.date);
          setVal("birthTime", state.birth.time);
          setVal("birthCity", state.birth.city);
          setVal("zodiac", state.birth.zodiac);
          setVal("includeReading", state.birth.includeSpiritualReading);
          setVal("faceShape", state.appearance.faceShape);
          setVal("facialHair", state.appearance.facialHair);
          setVal("freckles", state.appearance.freckles);
          setVal("hairLength", state.appearance.hairLength);
          setVal("hairTexture", state.appearance.hairTexture);
          setVal("hairColor", state.appearance.hairColor);
          setVal("eyeColor", state.appearance.eyeColor);
          setVal("eyeShape", state.appearance.eyeShape);
          setVal("skinTone", state.appearance.skinTone);
          setVal("apparentAge", state.appearance.apparentAge);
          setVal("culturalResonance", state.appearance.culturalResonance);
          setVal("slider_introvert", state.personality.introvertExtrovert);
          setVal("slider_grounded", state.personality.groundedAdventurous);
          setVal("slider_analytical", state.personality.analyticalCreative);
          setVal("ll_words", state.personality.loveLanguages.words);
          setVal("ll_qualityTime", state.personality.loveLanguages.qualityTime);
          setVal("ll_gifts", state.personality.loveLanguages.gifts);
          setVal("ll_acts", state.personality.loveLanguages.acts);
          setVal("ll_touch", state.personality.loveLanguages.touch);
          
          // values checkboxes
          [
            "family",
            "growth",
            "stability",
            "kindness",
            "spirituality",
            "ambition",
            "humor",
            "health",
            "curiosity",
            "service",
          ].forEach((v) => {
            const el = document.getElementById("val_" + v);
            if (el) el.checked = (state.personality.values || []).includes(v);
          });
          
          // must‑haves
          const mh = new Set(state.relationship.mustHaves || []);
          const map = {
            mh_kids: "wants-kids",
            mh_pet: "pet-friendly",
            mh_smoke: "non-smoker",
            mh_active: "active-lifestyle",
            mh_spirit: "spiritual-openness",
            mh_career: "career-driven",
            mh_family: "family-oriented",
          };
          Object.keys(map).forEach((id) => {
            const el = document.getElementById(id);
            if (el) el.checked = mh.has(map[id]);
          });
          
          // step 6 formats/addons - only set if elements exist
          setVal("artStyle", state.preferences.artStyle);
          setVal("auraPalette", state.preferences.auraPalette);
          
          const addonColor = document.getElementById("addon_color");
          if (addonColor) addonColor.checked = !!state.preferences.addons.colorUpgrade;
          
          const addonReading = document.getElementById("addon_reading");
          if (addonReading) addonReading.checked = !!state.preferences.addons.reading;
          
          const addonCompat = document.getElementById("addon_compat");
          if (addonCompat) addonCompat.checked = !!state.preferences.addons.compatibility;
          
          const addonRush = document.getElementById("addon_rush");
          if (addonRush) addonRush.checked = !!state.preferences.addons.rush12h;
          
          const fmtJpg = document.getElementById("fmt_jpg");
          if (fmtJpg) fmtJpg.checked = !!state.preferences.formats.jpg;
          
          const fmtPdf = document.getElementById("fmt_pdf");
          if (fmtPdf) fmtPdf.checked = !!state.preferences.formats.pdf;
        }

        function showComplete() {
          orderForm.style.display = "none";
          orderComplete.style.display = "block";
        }

        function escapeHtml(s) {
          return String(s).replace(
            /[&<>"']/g,
            (c) =>
              ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#039;",
              }[c])
          );
        }
      })();
    </script>
  </body>
</html>